"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./Api/index.js");const e="get_status",s="get_segmentation",n="get_template",r="get_contact",a="get_prot",c="put_contact",i="set_contact",o="send_text";exports.default=class Maxbot{constructor(t){return this.config={token:"",timeout:3e3,baseURL:"https://mbr.maxbot.com.br/api/v1.php"},this.ready=!1,this.cancelSources=[],this.setMe(t),this}async isReady(t){if(!this.config.token)return!1;return!t&&this.ready||(this.ready=await(async()=>{const t=await this.getStatus();return!!parseInt(t.status,10)})()),!!this.ready}setMe(t,e){const{config:s}=this;if("object"==typeof t){const e=Object.keys(t);for(let n=0;n<e.length;n++)e[n]in s&&(s[e[n]]=t[e[n]])}else"string"==typeof t&&t in s&&(s[t]="function"==typeof e?e():e);return this}getMe(){return this.config}async getStatus(){return await this.requestApi(e)}async getSegmentation(){return await this.requestApi(s)}async getTemplate(){return await this.requestApi(n)}async getContact(t){return await this.requestApi(r,t)}async getProt(t){return await this.requestApi(a,t)}async putContact(t){return await this.requestApi(c,t)}async setContact(t){return await this.requestApi(i,t)}async sendText(t,e){const{externalId:s,whatsapp:n,brCpf:r}=t,a={msg:e};if(s)a.ctExternalId=s;else if(n)a.ctWhatsapp=n;else{if(!r)return!1;a.ctBrCpf=r}return await this.requestApi(o,a)}async sendImage(t,e){}async sendFile(t,e){}async sendSound(t,e){}async requestApi(e,s={}){const n=this,r=t.getCancelToken().source(),a=r.token;this.addCancelSource(r);const c=await t.default.post(null,{cmd:e,token:n.config.token,...s},{timeout:n.config.timeout,baseURL:n.config.baseURL,cancelToken:a});return this.removeCancelSource(a),c}addCancelSource(t){return this.cancelSources.push({idToken:t.token,source:t}),this}removeCancelSource(t){if(t){const e=this.cancelSources.filter((({idToken:e})=>e!==t));return this.cancelSources=e||[],this}return this.cancelSources=[],this}cancel(){return this.cancelSources.forEach((({source:t})=>t&&t.cancel())),this.removeCancelSource(),this}};
